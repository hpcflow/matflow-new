doc:
  - >
    A simple crystal plasticity simulation using DAMASK. A volume element generated from a
    random voronoi tessellation is loaded uniaxially, using magnesium (Mg) material
    parameters.
tasks:
  - schema: generate_microstructure_seeds_from_random
    inputs:
      VE_size: [1, 1, 1]
      num_grains: 4
      phase_label: Mg

  - schema: generate_volume_element_from_voronoi
    inputs:
      homog_label: SX
      VE_grid_size: [8, 8, 8]

  - schema: simulate_VE_loading_damask
    inputs:
      load_case::uniaxial:
        total_time: 100
        num_increments: 1000
        direction: x
        target_def_grad_rate: 1.0e-3
        dump_frequency: 5
      homogenization:
        SX:
          mechanical: { type: "pass" }
          N_constituents: 1
      damask_phases:
        Mg:
          lattice: hP
          c/a: 1.62350 # from Tromans 2011, Elastic Anisotropy of HCP Metal Crystals and Polycrystals
          rho: 1740.0
          mechanical:
            output: [F, P, F_e, F_p, L_p, O]
            elastic:
              type: Hooke
              C_11: 59.3e9
              C_12: 25.7e9
              C_13: 21.4e9
              C_33: 61.5e9
              C_44: 16.4e9
            plastic:
              type: phenopowerlaw
              references:
                - F. Wang et al., Acta Materialia 80:77-93, 2014, https://doi.org/10.1016/j.actamat.2014.07.048
              output: [xi_sl, xi_tw]
              N_sl: [3, 3, 6, 0, 6] # basal, prism, 1. pyr<a>, -, 2. pyr<c+a>
              N_tw: [6, 0, 6] # tension, -, compression
              xi_0_sl: [10.e+6, 55.e+6, 60.e+6, 0., 60.e+6]
              xi_inf_sl: [40.e+6, 135.e+6, 150.e+6, 0., 150.e+6]
              xi_0_tw: [40.e+6, 0., 60.e+6]
              a_sl: 2.25
              dot_gamma_0_sl: 0.001
              dot_gamma_0_tw: 0.001
              n_sl: 20
              n_tw: 20
              f_sat_sl-tw: 10.0
              h_0_sl-sl: 500.0e+6
              h_0_tw-tw: 50.0e+6
              h_0_tw-sl: 150.0e+6
              h_sl-sl: [+1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,
                        +1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0, -1.0,
                        -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0,
                        -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0,
                        -1.0, -1.0, -1.0, -1.0, -1.0, -1.0,  1.0,  1.0,  1.0,  1.0,
                        +1.0,  1.0, -1.0, -1.0, -1.0, -1.0,  1.0,  1.0,  1.0,  1.0,
                        -1.0, -1.0, -1.0, -1.0,  1.0,  1.0,  1.0,  1.0,  1.0]  # unused entries are indicated by -1.0
              h_tw-tw: [+1.0,  1.0, -1.0, -1.0, -1.0, -1.0,  1.0, -1.0,  1.0,  1.0,
                        -1.0,  1.0]  # unused entries are indicated by -1.0
              h_tw-sl:  [1.0, -1.0,  1.0, -1.0,  1.0, -1.0,  1.0, -1.0,  1.0, -1.0,
                        1.0, -1.0, -1.0, -1.0, -1.0, -1.0, +1.0, -1.0,  1.0, -1.0]  # unused entries are indicated by -1.0
              h_sl-tw:  [1.0, -1.0,  1.0, -1.0,  1.0, -1.0,  1.0, -1.0,  1.0, -1.0,
                        1.0, -1.0, -1.0, -1.0, -1.0, -1.0, +1.0, -1.0,  1.0]  # unused entries are indicated by -1.0
      damask_post_processing:
        - name: add_stress_Cauchy
          args: { P: P, F: F }
          opts: { add_Mises: true }
        - name: add_strain
          args: { F: F, t: V, m: 0 }
          opts: { add_Mises: true }
        - name: add_strain
          args: { F: F_p, t: V, m: 0 }
          opts: { add_Mises: true }
        - name: add_IPF_color
          args: { l: [0, 0, 1] }
      VE_response_data:
        phase_data:
          - field_name: sigma_vM
            phase_name: Mg
            out_name: vol_avg_equivalent_stress
            transforms: [{ mean_along_axes: 1 }]
          - field_name: epsilon_V^0(F)_vM
            phase_name: Mg
            out_name: vol_avg_equivalent_strain
            transforms: [{ mean_along_axes: 1 }]
          - field_name: epsilon_V^0(F_p)_vM
            phase_name: Mg
            out_name: vol_avg_equivalent_plastic_strain
            transforms: [{ mean_along_axes: 1 }]
        field_data:
          - field_name: phase
          - field_name: O
        grain_data:
          - field_name: O
            increments: [{ values: [0, -1] }]
      damask_viz:
        fields: [F, F_p, P, sigma_vM, epsilon_V^0(F_p)_vM, IPFcolor_(0 0 1), phase]
        increments:
          - step: 100
